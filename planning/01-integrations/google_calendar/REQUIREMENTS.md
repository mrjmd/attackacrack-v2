# Google Calendar Integration Requirements - Attack-a-Crack v2

## Vision
Google Calendar is the source of truth for all scheduling, enabling automated follow-ups, smart scheduling recommendations, and seamless crew coordination while maintaining manual override capability.

## Critical Integration Points

### 1. Job Types & Visual Coding
**Two Primary Event Types:**
- **Assessment** (30-minute blocks)
  - Color: Purple/Grape
  - Purpose: Technician evaluates situation for quote
  - Default duration: 30 minutes
  
- **Repair Job** (4-hour default blocks)
  - Color: Green/Basil  
  - Purpose: Actual repair work
  - Default duration: 4 hours (adjustable based on job size)

### 2. Calendar Event Structure

**Event Title:**
- Customer name

**Event Color:**
- Purple/Grape = Assessment
- Green/Basil = Repair

**Event Location:**
- Full property address

**Event Description Must Include:**
```
Customer: [Name]
Phone: [Phone Number]
Job Type: [Assessment/Repair - Interior/Exterior]

Summary:
[Gemini-generated summary of conversation and quote details]

Service Details:
[Specific work to be performed]

Special Notes:
[Any important details for technician]

---
Generated by Attack-a-Crack CRM v2
```

**Event Attachments:**
- All photos/videos from customer (CRITICAL)
- Quote PDF (if applicable)

**Event Invitees:**
- Technician assigned (currently Mike Harrington)
- System to identify employees for special handling

## Job Completion Detection

### Completion Triggers
1. **Calendar Event**: Job scheduled for previous day exists
2. **QuickBooks Invoice**: Corresponding invoice created

### Event Updates on Completion
- Mark calendar event as completed
- Trigger automated messaging system for follow-ups
- Update job status in CRM

*Note: Automated follow-up messaging specifications are in `/planning/02-features/automated-messaging/`*

## Daily Automation Tasks

### Morning Tasks (6 AM)
**Quote-to-Invoice Conversion:**
- Find all repair jobs scheduled for today
- Auto-generate invoices in QuickBooks
- Add to dashboard: "Invoices ready for today's jobs âœ“"

### Evening Tasks (6 PM)
**Next-Day Preparation:**
- Check tomorrow's schedule
- Verify all required attachments present
- Alert if missing photos for any job
- Weather check for exterior jobs

## Smart Scheduling Features

### Scheduling Intelligence (Future Deep Dive Needed)
**Factors for Recommendation:**
- Job duration estimates
- Travel time between locations
- Buffer time requirements
- Crew availability
- Weather constraints for exterior work
- Customer preference patterns

**Smart Suggestions:**
- "Best time slot: Thursday 10am (20 min from previous job)"
- "Warning: 3 jobs already scheduled this day"
- "Rain forecast - suggest rescheduling exterior work"

### Interior vs Exterior Toggle
**Job Classification:**
- System guesses based on job type:
  - Resurfacing â†’ Usually exterior
  - Crack repair â†’ Usually interior
  - Waterproofing â†’ Usually interior
- Manual override always available
- Critical for weather-aware scheduling

## Weather-Aware Scheduling

### Rain Impact Alerts
**For Exterior Jobs:**
- Check weather 48 hours ahead
- If >60% rain probability:
  - Dashboard alert: "âš ï¸ Rain forecast for exterior job"
  - Auto-generate todo: "Contact [customer] to reschedule"
  - Suggested message template provided

**For All Jobs (Opportunity Alert):**
- Heavy rain in 24-48 hours:
  - Todo: "ðŸ“ˆ Increase Google Ads spend (rain coming)"
  - Direct adjustment button on dashboard

## Photo Workflow Integration

### Technician Photo Upload Process
**Current Manual Flow:**
1. Technician completes job
2. Takes before/during/after photos on phone
3. Opens Google Calendar app
4. Adds photos to completed event
5. Adds marketer as invitee to trigger notification

**System Detection:**
- Monitor calendar events for new attachments
- When photos detected on completed job:
  - Download and store locally
  - Add to marketer's photo queue
  - Generate thumbnails
  - Trigger AI caption generation
  - No need for manual marketer invite

### Photo Requirements
**File Handling:**
- Accept all image formats (JPEG, PNG, HEIC)
- Auto-convert HEIC to JPEG for compatibility
- Maintain original quality for archives
- Generate web-optimized versions for display

**Metadata Preservation:**
- Timestamp (when taken)
- GPS location (if available)
- Original filename
- Technician who uploaded

## Employee Identification & Special Handling

### Employee Features
**Identify as Employee:**
- Special contact flag in system
- Currently: Mike Harrington (technician)

**Special Behaviors:**
- Conversations pinned to top of activity feed
- Different notification handling
- Can be assigned to calendar events
- Access to job details in calendar

## Google Ads Integration

### Manual Controls (MVP)
**Dashboard Widget:**
- Current daily budget display
- Quick adjustment buttons: [+$50] [+$100] [Reset]
- "Rain boost" preset: 2x normal spend

### Automated Adjustments (Future)
**Weather-Based Rules:**
- If rain >70% in 48hrs â†’ Increase budget 50%
- If rain >90% in 24hrs â†’ Increase budget 100%
- Dry spell >7 days â†’ Decrease budget 25%

## API Requirements

### Google Calendar API
**Scopes Needed:**
- `calendar.events.read` - Read all events
- `calendar.events.write` - Create/update events
- `calendar.attachments` - Handle media files

**Operations:**
- Create events with all metadata
- Update events (rescheduling)
- Query events by date range
- Attach files to events
- Set event colors

### Google Ads API (Future)
**Scopes Needed:**
- `adwords` - Campaign management

**Operations:**
- Get current budget
- Adjust daily budget
- Get performance metrics


## Implementation Priority

### MVP (Must Have)
1. Read/write calendar events
2. Job completion detection
3. Day 1 & Day 7-10 follow-ups
4. Event structure with all required fields
5. Quote-to-invoice morning automation
6. Interior/exterior toggle

### Phase 2 (Should Have)
1. Weather-aware scheduling
2. Smart scheduling recommendations
3. Google Ads manual controls
4. Employee special handling
5. Photo attachment handling for technician

### Phase 3 (Could Have)
1. Automated Google Ads adjustments
2. Multi-crew calendar management
3. Capacity planning
4. Route optimization

## Technical Considerations

### Calendar as Source of Truth
- All scheduling changes sync FROM Calendar
- System reads Calendar, never overwrites without user action
- Manual changes in Google Calendar respected
- Two-way sync with conflict resolution favoring Calendar

### Real-time Sync
- Watch for calendar changes via webhooks
- Update CRM within 5 seconds of Calendar change
- Show sync status on dashboard

### Media Handling
**Pre-Job (from Customer):**
- Download photos/videos from OpenPhone conversations
- Upload to Google Drive
- Attach Drive links to Calendar events
- Ensure technician can access on mobile

**Post-Job (from Technician):**
- Detect new photos added to calendar events
- Download and store for marketing use
- Auto-notify marketer dashboard
- Maintain organization by job/date

## Success Metrics

### Automation Metrics
- Follow-up messages sent: 100% within 24 hours
- Invoice preparation time saved: 30 min/day
- Weather-based rescheduling: 0 rain delays

### User Experience Metrics
- Calendar sync lag: <5 seconds
- Smart suggestion accuracy: >80%
- Technician satisfaction with event details: 100%
- Photo workflow efficiency: All photos accessible to marketer within 1 hour

## Questions for Next Session

1. **Multi-location**: When you expand to Connecticut, separate calendar or filtered view?
2. **Recurring Jobs**: Any regular maintenance contracts needing special handling?
3. **Emergency Jobs**: How to handle same-day urgent requests?
4. **Capacity Planning**: Max jobs per day? Seasonal variations?
5. **Travel Time**: Default buffer between jobs? Does it vary by distance?

---

*Google Calendar integration is critical for operational efficiency and customer satisfaction through automated follow-ups and smart scheduling.*